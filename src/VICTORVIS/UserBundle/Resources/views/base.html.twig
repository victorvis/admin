{% extends '::base.html.twig' %}

{% block stylesheets %}
    {% stylesheets 'bundles/victorvisuser/css/*.css' filter='cssrewrite' %}
        <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
{% endblock %}

{% block javascripts %}
    {% javascripts
        '@VICTORVISUserBundle/Resources/public/js/jquery.js'
        '@VICTORVISUserBundle/Resources/public/js/jquery.placeholder.js'
        '@VICTORVISUserBundle/Resources/public/js/*' %}
        <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
<!--
    <script type="text/javascript">
        function goLogIn(){
            window.location.href = "{{ path('_security_check_facebook') }}";
        }
        
        function onFbInit() {
            if (typeof(FB) != 'undefined' && FB != null ) {              
                FB.Event.subscribe('auth.statusChange', function(response) {
                    if (response.session || response.authResponse) {
                        setTimeout(goLogIn, 500);
                    } else {
                        window.location.href = "{{ path('_security_facebook_logout') }}";
                    }
                });
            }
        }
    </script>
-->
    <script>
        window.fbAsyncInit = function() {
            FB.init({
                appId      : '{{ facebook_app_id }}',
                status     : true, // check login status
                cookie     : true, // enable cookies to allow the server to access the session
                xfbml      : false  // parse XFBML
            });

            FB.getLoginStatus(function(response) {
                {% if app.session.get('facebook.logout') is not null %}
                    var sessionClean = {{ app.session.remove('facebook.logout') }};
                    FB.logout();
                {% endif %}
                var button = $('a.connect.facebook');
                if (button.length > 0) {
                    var url = button.data('href');
                    if (response.status === 'unknown') {
                        url += '?logout';
                    }
                    button.attr('href', url);
                }

            });
        };

        (function(d){
            var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement('script'); js.id = id; js.async = true;
            js.src = "//connect.facebook.net/en_US/all.js";
            ref.parentNode.insertBefore(js, ref);
        }(document));
    </script>
{% endblock %}